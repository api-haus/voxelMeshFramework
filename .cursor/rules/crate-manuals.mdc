---
# globs: crates/**,Cargo.toml,crates/**/Cargo.toml
alwaysApply: true
---

### Crate Manuals First (Context7 MCP)

Before proposing or implementing any code change, consult the upstream manuals/documentation for the affected third-party crates (especially Bevy and its subcrates) using the Context7 MCP documentation tools.

#### When this applies
- Editing Rust files that import external crates or Bevy modules
- Changing `Cargo.toml` dependencies or resolving compile errors referencing external crate APIs
- Planning upgrades/refactors touching Bevy systems, rendering, assets, input, time, states, or plugins

#### Required procedure (do this first)
1) Identify impacted crates
- From `use` lines, error messages, and `Cargo.toml`. For Bevy, consider `bevy`, `bevy_ecs`, `bevy_app`, `bevy_asset`, `bevy_render`, `bevy_pbr`, `bevy_sprite`, `bevy_ui`, and related crates like `glam`, `winit` and others.

2) Fetch manuals with Context7
- Resolve the library: call resolve-library-id with the crate name (e.g., "bevy").
- Retrieve docs: call get-library-docs with the resolved ID. Choose a topic relevant to your change. Defaults for Bevy: "ecs", "app", "rendering", "pbr", "assets", "input", "time", "plugins", "states", "migration", "release notes".

3) Check versions
- Read the version in `Cargo.toml`/`Cargo.lock`. Prefer docs for that version; otherwise note the mismatch and review migration notes.

4) Capture a brief "Manual Check" note before editing
- Crates and versions consulted
- Doc sections/topics reviewed
- 2–4 bullets of key guidance or constraints to apply

Example note:
Manual Check
- Crates: bevy(0.13), bevy_ecs(0.13)
- Topics: ecs systems, states
- Key: Schedule V3 requires `.configure_sets` and `.in_state`; use `SystemSet` chaining for order

#### Rules of thumb
- Prefer manual guidance over assumptions; document rationale if deviating
- If impact is uncertain, perform the manual check anyway
- When multiple library matches exist, pick the most relevant high-trust one; otherwise ask for clarification

#### Tools
- Use Context7 MCP: resolve-library-id → get-library-docs
- Do not paste raw URLs; cite sections/topics by name in notes

